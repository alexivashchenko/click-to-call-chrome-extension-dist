let Helpers={dev:!0,log:function(...arguments){if(0==Helpers.dev)return!1;arguments.length>0&&arguments.forEach((e=>{console.log(e)}))},maybeReloadPage:function(){return alert('Please check "VoiceMPower" settings and reload the page.'),!0},runBackgroundCommand:function(e,t){Helpers.log("runBackgroundCommand start: "+e,t);let o="__rw_chrome_ext_reply_"+(new Date).getTime();try{if(void 0===chrome.runtime)return Helpers.maybeReloadPage(),!1;chrome.runtime.sendMessage({type:e,data:t},(function(t){void 0!==chrome.runtime.lastError&&(void 0!==chrome.runtime.lastError.message?Helpers.log("chrome.runtime.lastError.message for: "+e,t,chrome.runtime.lastError.message):Helpers.log("chrome.runtime.lastError.message for: "+e,t,chrome.runtime.lastError)),document.createEvent("Events").initEvent(o,!1,!1),Helpers.log("runBackgroundCommand end: "+e,t)}))}catch(e){console.log("Error",e),Helpers.maybeReloadPage()}}},CTC={requiredSettings:["server","port","extension","password"]};function initReloadPageButtons(){let e=document.querySelectorAll(".reloadPage");e.length>0&&e.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),chrome.tabs.getSelected(null,(function(e){chrome.tabs.executeScript(e.id,{code:"window.location.reload();"})})),location.reload(),window.close()}))}))}function initLogOutPageButtons(){let e=document.querySelectorAll(".logOut");e.length>0&&e.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault(),Helpers.runBackgroundCommand("disconnect"),window.location.href="popup.html"}))}))}window.addEventListener("load",(()=>{let e=document.querySelector("#settings");null!==e&&(chrome.storage.local.get("settings",(t=>{if(void 0!==t.settings&&(t=t.settings),void 0!==t)for(const o in t){let r=e.querySelector('input[name="'+o+'"]:not([type="hidden"])');"text"!=r.type&&"password"!=r.type||(r.value=t[o]),"checkbox"==r.type&&("true"==t[o]?r.checked=!0:r.checked=!1)}if(void 0!==t){let e=[];if(CTC.requiredSettings.forEach((function(o){o in t||e.push(o)})),0==e.length){document.querySelector("#settings").remove();let e=document.querySelector("#messages");e.classList.add("active"),e.classList.add("success"),e.innerHTML="<h3>Settings saved.</h3><p>You are logged as</p><h2>"+t.extension+'</h2><button class="logOut">Log Out</button>',initLogOutPageButtons()}}})),e.addEventListener("submit",(t=>{t.preventDefault();let o=new FormData(e),r={};for(let e of o.entries())r[e[0]]=e[1];chrome.storage.local.set({settings:r},(()=>{document.querySelector("#settings").remove();let e=document.querySelector("#messages");e.classList.add("active"),e.classList.add("success"),e.innerHTML='<h3>Settings saved.</h3><p>Page reload required.</p><button class="reloadPage">Reload Page</button>',Helpers.runBackgroundCommand("init"),initReloadPageButtons()}))})))}),!1);